var ptl = window.location.protocol;
switch(ptl) {
   case 'http:':
   case 'https:':
     var url = document.referrer || window.location.href,
        urlExcept = ['wrj2wmy.github.io', 'spritiwrj.github.io'];
     var contains = listContainsStr(urlExcept, url);
     break;
   case 'file:':
     var contains = true; // Bypass the domain validation
     break;
   default:
     var contains = false;// block others
}
if (!contains) {
        var msg = "<p>本页面禁止被内嵌。</p>";
        msg += "<p>请点击下方链接访问源页面。</p>";
        msg += "<p><a href='http://wrj2wmy.github.io' target='_blank'>悬赏封印查询网页版</a></p>";
        document.querySelector(".msg").innerHTML = msg;
        document.querySelector(".msg").classList.remove("hide");
        document.querySelector(".search-banner").classList.add("hide");
        document.querySelector(".search-bar").classList.add("hide");
        document.querySelector(".content").classList.add("hide");
        window.open('http://wrj2wmy.github.io')
};

function search(a) {
        var b = a || document.querySelector("#searchItem").value,
                cellList = document.querySelectorAll(".content .table > .table-row-group > .table-row > .table-cell");
        if (b.indexOf('*') > -1 || b.indexOf('x') > -1) {
                b = b.split('*').join('×').split('x').join('×')
        }
        removeChildNodesHide(document.querySelector(".content"));
        resetLightFont();
        if (b && b.trim()) {
                var c = searchClue(b.trim());
                displayCell(c, cellList)
        }
}
function searchClue(a) {
        var b = [a],
                clueCellList = document.querySelectorAll(".content .table.clue > .table-row-group > .table-row > .table-cell.clue-cell");
        for (var c = 0; c < clueCellList.length; c++) {
                var d = clueCellList[c],
                        clueHTML = d.innerHTML;
                if (clueHTML.indexOf(a) > -1) {
                        var e = d.parentNode.querySelectorAll(".table-cell")[1].innerHTML;
                        if (b.indexOf(e) === -1) {
                                b.push(e)
                        }
                }
        }
        return b
}
function displayCell(a, b) {
        for (var i = 0; i < b.length; i++) {
                var c = b[i],
                        innerHTML = c.innerHTML,
                        matchResult = indexOfArray(innerHTML, a);
                if (matchResult.result) {
                        c.classList.remove("hide");
                        for (var d = 0; d < matchResult.matchArray.length; d++) {
                                var e = matchResult.matchArray[d],
                                        lightHtml = "<span class='light'>" + e + "</span>";
                                c.innerHTML = innerHTML.split(e).join(lightHtml)
                        }
                } else if (c.querySelectorAll("span.light").length === 0) {
                        c.classList.add("hide")
                }
        }
        displayChapter()
}
function displayChapter() {
        var a = document.querySelectorAll(".content .table");
        for (var t = 0; t < a.length; t++) {
                var b = a[t],
                        groupList = b.querySelectorAll(".table-row-group");
                for (var g = 0; g < groupList.length; g++) {
                        var c = groupList[g],
                                rowList = c.querySelectorAll(".table-row");
                        for (var r = 0; r < rowList.length; r++) {
                                var d = rowList[r];
                                if (d.querySelectorAll(".table-cell:not(.hide)").length === 0) {
                                        d.classList.add("hide")
                                } else {
                                        d.classList.remove("hide");
                                        removeChildNodesHide(d)
                                }
                        }
                        if (c.querySelectorAll(".table-row:not(.hide)").length === 0) {
                                c.classList.add("hide")
                        } else {
                                c.classList.remove("hide");
                                var e = c.querySelector(".table-row.chapter-header"),
                                        $currentGroupContent = c.querySelectorAll(".table-row:not(.chapter-header)");
                                if (e.classList.contains("hide") && $currentGroupContent[0].querySelectorAll(".table-cell")[0].innerHTML.indexOf("回合") === -1) {
                                        e.classList.remove("hide");
                                        removeChildNodesHide(e)
                                } else {
                                        for (var f = 0; f < rowList.length; f++) {
                                                var d = rowList[f];
                                                d.classList.remove("hide");
                                                removeChildNodesHide(d)
                                        }
                                }
                        }
                }
                if (b.querySelectorAll(".table-row-group:not(.hide)").length === 0) {
                        b.classList.add("hide")
                } else {
                        b.classList.remove("hide")
                }
        }
}
function show(a) {
        switch (a) {
        case 'n':
                var a = document.querySelector("div.hero-n");
                a.classList.remove("hide");
                var b = document.querySelector("div.hero-r");
                b.classList.add("hide");
                var c = document.querySelector("div.hero-sr");
                c.classList.add("hide");
                var d = document.querySelector("div.hero-ssr");
                d.classList.add("hide");
                break;
        case 'r':
                var a = document.querySelector("div.hero-n");
                a.classList.add("hide");
                var b = document.querySelector("div.hero-r");
                b.classList.remove("hide");
                var c = document.querySelector("div.hero-sr");
                c.classList.add("hide");
                var d = document.querySelector("div.hero-ssr");
                d.classList.add("hide");
                break;
        case 'sr':
                var a = document.querySelector("div.hero-n");
                a.classList.add("hide");
                var b = document.querySelector("div.hero-r");
                b.classList.add("hide");
                var c = document.querySelector("div.hero-sr");
                c.classList.remove("hide");
                var d = document.querySelector("div.hero-ssr");
                d.classList.add("hide");
                break;
        case 'ssr':
                var a = document.querySelector("div.hero-n");
                a.classList.add("hide");
                var b = document.querySelector("div.hero-r");
                b.classList.add("hide");
                var c = document.querySelector("div.hero-sr");
                c.classList.add("hide");
                var d = document.querySelector("div.hero-ssr");
                d.classList.remove("hide");
                break
        }
}
function removeChildNodesHide(a) {
        var b = a.querySelectorAll(".hide:not(.msg)");
        for (var n = 0; n < b.length; n++) {
                b[n].classList.remove("hide")
        }
}
function resetLightFont() {
        var a = document.querySelectorAll("span.light");
        for (var l = 0; l < a.length; l++) {
                var b = a[l];
                b.outerHTML = b.innerHTML
        }
}
function indexOfArray(a, b) {
        var c = {
                "result": false,
                "matchArray": []
        };
        for (var i = 0; i < b.length; i++) {
                if (a.indexOf(b[i]) > -1) {
                        c.result = true;
                        c.matchArray.push(b[i])
                }
        }
        return c
}
function listContainsStr(a, b) {
        var c = false;
        for (var i = 0; i < a.length; i++) {
                var d = a[i];
                if (b.indexOf(d) > -1) {
                        c = true
                }
        }
        return c
}
function smoothscroll(){
    var currentScroll = document.documentElement.scrollTop || document.body.scrollTop;
    if (currentScroll > 0) {
         window.requestAnimationFrame(smoothscroll);
         window.scrollTo (0,currentScroll - (currentScroll/5));
    }
}